{% extends 'appomatic_siteinfo/models/BaseModel/page.html' %}
{% load endless %}

{% block content_title_content %}
  {{block.super}}
  {{obj.name}}
{% endblock %}

{% block properties %}
  <tr><th>Aliases</th><td>
    {% for alias in obj.aliases.all %}
      {{alias.name}},
    {% endfor %}
  </td></tr>
{% endblock %}

{% block content_outer %}
  <iframe class="map" src="{% url 'appomatic_mapserver.views.application' application='appomatic_siteinfo.models.SiteInfoMap' %}?company={{obj.id}}"></iframe>
  <div class="objinfo">
    {{block.super}}
  </div>
{% endblock %}


{% block content %}
  {{block.super}}

  {% if obj.supplies.all %}
    <h2>Supplied these chemicals</h2>
    {% paginate 10 obj.supplies.all as paginated_chemicals %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>Trade name</th><th>Ingredients</th><th>CAS type</th><th>CAS number</th><th>Purposes</th></thead>
      <tbody>
        {% for chemical in paginated_chemicals %}
          <tr>
            <td><a href="{{chemical.get_absolute_url}}">{{chemical.trade_name}}</td>
            <td><a href="{{chemical.get_absolute_url}}">{{chemical.ingredients}}</td>
            <td><a href="{{chemical.get_absolute_url}}">{{chemical.cas_type}}</td>
            <td><a href="{{chemical.get_absolute_url}}">{{chemical.cas_number}}</td>
            <td>
              {% for purpose in chemical.purposes.all %}
                {{purpose.render_as.link|safe}}
              {% endfor %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

  {% if obj.supplied_sites.all %}
    <h2>Supplied chemicals to these sites</h2>
    {% paginate 10 obj.supplied_sites.all as paginated_sites %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>Name</th><th>Latitude</th><th>Longitude</th></tr></thead>
      <tbody>
        {% for site in paginated_sites %}
          <tr>
            <td><a href="{{site.get_absolute_url}}">{{site.name}}</td>
            <td><a href="{{site.get_absolute_url}}">{{site.latitude}}</td>
            <td><a href="{{site.get_absolute_url}}">{{site.longitude}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

  {% if obj.operates_at_sites.all %}
    <h2>Operates these sites</h2>
    {% paginate 10 obj.operates_at_sites.all as paginated_sites %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>Name</th><th>Latitude</th><th>Longitude</th></tr></thead>
      <tbody>
        {% for site in paginated_sites %}
          <tr>
            <td><a href="{{site.get_absolute_url}}">{{site.name}}</td>
            <td><a href="{{site.get_absolute_url}}">{{site.latitude}}</td>
            <td><a href="{{site.get_absolute_url}}">{{site.longitude}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

  {% if obj.supplied_wells.all %}
    <h2>Supplied chemicals to these wells</h2>
    {% paginate 10 obj.supplied_wells.all as paginated_wells %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>API</th><th>Latitude</th><th>Longitude</th></tr></thead>
      <tbody>
        {% for well in paginated_wells %}
          <tr>
            <td><a href="{{well.get_absolute_url}}">{{well.api}}</td>
            <td><a href="{{well.get_absolute_url}}">{{well.latitude}}</td>
            <td><a href="{{well.get_absolute_url}}">{{well.longitude}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

  {% if obj.operates_at_wells.all %}
    <h2>Operates these wells</h2>
    {% paginate 10 obj.operates_at_wells.all as paginated_wells %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>API</th><th>Latitude</th><th>Longitude</th></tr></thead>
      <tbody>
        {% for well in paginated_wells %}
          <tr>
            <td><a href="{{well.get_absolute_url}}">{{well.api}}</td>
            <td><a href="{{well.get_absolute_url}}">{{well.latitude}}</td>
            <td><a href="{{well.get_absolute_url}}">{{well.longitude}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

  {% if obj.supplied_event.all %}
    <h2>Supplied chemicals to these events</h2>
    {% paginate 10 obj.supplied_event.all as paginated_supply %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>Time</th><th>Chemical</th><th>Purpose</th><th>Type</th><th>Site</th><th>Well</th></tr></thead>
      <tbody>
        {% for supply in paginated_supply %}
          {% with event=supply.event.leafclassobject %}
            <tr>
              <td><a href="{{event.get_absolute_url}}">{{event.datetime}}</a></td>
              <td>{{supply.chemical.render_as.link|safe}}</td>
              <td>{{supply.purpose.render_as.link|safe}}</td>
              <td><a href="{{event.get_absolute_url}}">{{event.type_name}}</a></td>
              <td>{{event.site.render_as.link|safe}}</td>
              <td>{{event.well.render_as.link|safe}}</td>
            </tr>
          {% endwith %}
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

  {% if obj.events.all %}
    <h2>Responsible for these events</h2>
    {% paginate 10 obj.events.all as paginated_events %}
    <table class="table table-striped table-bordered table-condesed">
      <thead><tr><th>Type</th><th>Time</th><th>Latitude</th><th>Longitude</th><th>Site</th><th>Well</th></tr></thead>
      <tbody>
        {% for event in paginated_events %}
          <tr>
            <td><a href="{{event.get_absolute_url}}">{{event.type_name}}</td>
            <td><a href="{{event.get_absolute_url}}">{{event.datetime}}</td>
            <td><a href="{{event.get_absolute_url}}">{{event.latitude}}</td>
            <td><a href="{{event.get_absolute_url}}">{{event.longitude}}</td>
            <td><a href="{{event.site.get_absolute_url}}">{{event.site}}</td>
            <td><a href="{{event.well.get_absolute_url}}">{{event.well}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="pagination">{% show_pages %}</div>
  {% endif %}

{% endblock %}
